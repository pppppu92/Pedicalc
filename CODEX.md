以下の内容を実装すること

実装するもの
name: PediCalc
説明: 小児薬剤投与量の計算を行います

Webアプリケーション仕様書（骨子案）
1. プロジェクト概要
プロジェクトの目的や対象、本システムの役割などを簡潔に記述します。

1.1. プロジェクト名

1.2. 目的

小児科医の薬剤投与量計算業務の効率化

1.3. 対象ユーザー

小児科医

1.4. システムのスコープ

本Webアプリケーションで実現する範囲を定義します。

2. 要件定義
これまでにヒアリングした内容を体系的にまとめます。

2.1. ユーザー要件

小児科医が本システムで「何をしたいか」を具体的に記述します。

年齢・体重入力による薬剤量計算

薬剤の登録・管理

計算結果の確認

2.2. 機能要件

ユーザー要件を実現するためにシステムが「何をすべきか」を機能単位で記述します。

2.2.1. 薬剤投与量計算機能

入力項目の詳細（年齢、体重、薬剤選択）

計算ロジックの詳細（年齢区分、体重換算、成人量上限処理）

出力表示の詳細（表示形式、単位、成人量表示の付記）

2.2.2. 薬剤登録・管理機能

新規薬剤登録の詳細（入力項目：薬剤名、成人量、各年齢別投与量）

薬剤一覧表示の詳細（ソート機能含む）

薬剤の編集・削除機能

2.2.3. データ管理機能

薬剤データの保存方法（ローカルファイルでの管理方法など）

2.3. 非機能要件

システムの品質、性能、運用などに関する要件を記述します。

2.3.1. パフォーマンス

応答速度（速やかな反応、計算終了次第表示）

2.3.2. セキュリティ

データ保護（対策不要）

認証・認可（不要）

2.3.3. 可用性

稼働時間（問わない）

バックアップ・復旧（対策不要）

2.3.4. 保守性・運用性

システム更新の容易性

エラーハンドリング（不正入力時のメッセージ表示）

ログ機能（不正入力以外のエラーログをテキストファイルに出力）

2.3.5. 拡張性

将来的な患者IDとの紐付け可能性

2.3.6. 環境要件

利用環境（ローカルHTMLファイル、Internet Explorer）

開発言語（HTML/JavaScript）

1. 画面設計の詳細化
1.1. 画面ワイヤーフレーム / プロトタイプ:
薬剤計算画面:

年齢入力フォーム:

テキストボックス2つを用意。左が「歳」、右が「か月」。

ユーザーは数字を入力。

「歳」のテキストボックスから Tabキーで「か月」のテキストボックスへ遷移可能。

「か月」のテキストボックスから Tabキーで体重テキストボックスへ遷移可能。

体重入力フォーム:

テキストボックス1つ。小数点以下の入力に対応。単位はkgと明記。

薬剤選択の表示形式:

検索BOX付きテーブルで登録薬剤を一覧表示。

テーブルのヘッダーをクリックすることで、その列のデータでソートが可能。

テーブルの列には「薬剤名」「薬剤分類」などが表示されることを想定。

計算結果の表示エリア:

薬剤選択・年齢・体重入力フォームの下に配置。

表示項目：「薬剤名」「薬剤分類」「投与量(mg)」「投与回数(例：分3)」

成人量メッセージの表示例: アセトアミノフェン 解熱鎮痛薬 4000mg(成人量) 分4

投与量(mg)の横に(成人量)を付記。

「計算」ボタン:

年齢・月齢テキストボックスと体重テキストボックスの下に改行して配置。

年齢・体重を入力後、Enterキーを押しても計算が実行されるようにする。

薬剤登録画面への遷移ボタン:

画面の隅に常に表示（例: 右上または左下固定など）。クリックで薬剤登録画面をポップアップ表示。

薬剤登録画面:

表示形式: 薬剤計算画面と同一ページ内にポップアップで表示。

各入力フィールドの具体的な形式:

各項目名（薬剤名、薬剤分類、用法、回数、成人量、6か月未満、6か月以上1歳未満投与量、1歳以上3歳未満投与量、3歳以上8歳未満投与量、8歳以上12歳未満投与量、12歳以上成人未満、投与可能最低年齢）に対応するテキストボックスを用意。

投与可能最低年齢の入力形式: 「3y2m」「7y0m」など。

投与量に「-」の入力を許可。

「登録」ボタン:

シンプルに配置。

「キャンセル」ボタンは不要。

薬剤一覧・編集・削除機能:

ポップアップ内に、登録済みの薬剤をテーブル形式で一覧表示。

各行の値をクリックすることで編集可能にする（インライン編集、または別途編集フォーム表示）。

各行に削除ボタンを配置。

1.2. 画面遷移図の詳細化:
主要な画面は「薬剤計算画面」のみとし、その中に薬剤登録/管理機能がポップアップとして組み込まれる。

薬剤登録画面（ポップアップ）は、「登録」ボタンで確定後、ポップアップが閉じ、薬剤計算画面に戻る。

薬剤登録画面内の薬剤一覧で値を編集した場合、自動的に変更が保存されるか、別途「保存」ボタンが必要か、追って検討。一旦はインライン編集での自動保存を想定。

2. データ設計の詳細化
2.1. データ項目定義:
薬剤データは、以下の項目と制約を持つ構造とします。

name (薬剤名): 文字列、必須

category (薬剤分類): 文字列、任意 (例: "解熱鎮痛薬", "抗菌薬")

usage (用法): 文字列、任意 (例: "内服", "外用")

frequency (回数): 文字列、任意 (例: "分3", "分4")

adult_dose (成人量): 数値 (mg/day)、必須

dose_lt_6m (6か月未満投与量): 数値 (mg/day) または 文字列 - (投与不可)、必須

dose_6m_lt_1y (6か月以上1歳未満投与量): 数値 (mg/day) または 文字列 -、必須

dose_1y_lt_3y (1歳以上3歳未満投与量): 数値 (mg/day) または 文字列 -、必須

dose_3y_lt_8y (3歳以上8歳未満投与量): 数値 (mg/day) または 文字列 -、必須

dose_8y_lt_12y (8歳以上12歳未満投与量): 数値 (mg/day) または 文字列 -、必須

dose_12y_lt_adult (12歳以上成人未満投与量): 数値 (mg/day) または 文字列 -、必須

min_age (投与可能最低年齢): 文字列 (例: "3y2m", "7y0m") または 文字列 - (制限なし)、必須

補足:

投与量は全て1日投与量 (mg/day) で入力・計算。

数値入力は正の数のみ許可。

dose_lt_6mなど、投与量に**「-」が入力された場合は、その年齢層では投与不可**と判定。

2.2. データ保存方法:
薬剤データはJSON形式で保存。

localStorage を優先的に利用し、ブラウザを閉じてもデータが維持されるようにする。ブラウザのキャッシュクリアでデータが消える可能性は許容する。

HTMLファイルと同一フォルダ内にJSONファイルとして保存する機能については、JavaScriptから直接ローカルファイルシステムへの書き込みはセキュリティ上の制約が非常に高いため、ユーザーが手動で「エクスポート（JSONファイルをダウンロード）」し、「インポート（JSONファイルをアップロード）」する機能として代替案を検討します。これにより、ユーザーが意図的にデータをバックアップ・復元できる手段を提供します。

(localStorageのみで十分な場合、このファイル保存機能は不要ですが、念のため代替案として提示します)

3. ロジック設計の詳細化
3.1. 計算ロジック詳細:
年齢階層の自動判定:

入力された「〇歳〇か月」を基に、以下の区分でどの投与量を適用するかを判定。

6か月未満

6か月以上1歳未満

1歳以上3歳未満

3歳以上8歳未満

8歳以上12歳未満

12歳以上成人未満

月齢の扱い: 1歳未満は月単位で厳密に、1歳以上は「X歳以上Y歳未満」で判断します。例: 3歳2か月は「3歳以上8歳未満」に該当し、dose_3y_lt_8y を適用。

投与可能最低年齢のチェック:

min_ageが設定されている場合、入力された小児の年齢がその最低年齢に満たない場合は、計算結果を表示せず、「投与不可」 の旨を表示する。

成人量上限の判定と適用フロー:

体重換算で算出した投与量が adult_dose を超える場合：

最終的な投与量を adult_dose に置き換える。

表示される投与量には (成人量) を付記。

例: XXmg (成人量) と表示。XX はその薬剤の成人量。

3.2. エラーハンドリングの詳細:
不正な入力値の定義:

年齢（歳・月）: 正の数以外の入力、または空欄（月齢は1歳以上の場合0か月とみなすため、空欄でもエラーにしない）。

体重: 正の数以外の入力、または空欄。

薬剤登録時の各投与量: 正の数以外の入力、または「-」以外の文字列。

エラーメッセージの内容と表示方法:

不正な入力があった場合、アラート表示（alert()関数など）でユーザーに通知。

メッセージは具体的に「体重は正の数を入力してください」のように表示。

ログ機能:

不正な入力以外のエラー（例: JavaScriptのランタイムエラーなど）が発生した場合、ブラウザの開発者ツールコンソールに表示するだけでなく、テキストファイルとして記録する機能を別途検討。JavaScriptでクライアントサイドから直接ファイルに書き込むのは難しいですが、console.error()などを利用し、ユーザーにエラーログの保存を促す、といった形になる可能性があります。
